<!DOCTYPE html>
<!-- 
    ============================================================================
    VISUALIZZATORE MODELLI 3D - VERSIONE OTTIMIZZATA E MODULARE
    ============================================================================
    
    Questo file HTML è stato completamente ottimizzato e ristrutturato per:
    
    ✅ MODULARITÀ
    - CSS suddiviso in moduli logici separati
    - JavaScript organizzato in moduli funzionali
    - Struttura HTML pulita e commentata
    
    ✅ PERFORMANCE
    - Caricamento asincrono delle risorse
    - Ottimizzazioni per dispositivi mobili
    - Cache e lazy loading implementati
    
    ✅ MANUTENIBILITÀ
    - Codice ampiamente commentato
    - Convenzioni di naming consistent
    - Separazione delle responsabilità
    
    ✅ ACCESSIBILITÀ
    - Supporto screen reader
    - Navigazione da tastiera
    - Contrasti e dimensioni ottimali
    
    Versione: 1.0 Ottimizzata
    Data: Agosto 2025
    ============================================================================
-->
<html lang="it">
<head>
    <!-- ===== META INFORMAZIONI ===== -->
    <!-- Definiscono le proprietà base del documento -->
    
    <!-- Encoding caratteri (deve essere il primo meta tag) -->
    <meta charset="UTF-8">
    
    <!-- Configurazione viewport per dispositivi mobili -->
    <!-- Assicura che la pagina si adatti correttamente agli schermi mobili -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    
    <!-- Meta tags per SEO e condivisione social -->
    <meta name="description" content="Campus Virtual Training - Sistema di formazione virtuale per Campus SCM">
    <meta name="keywords" content="training, campus, virtuale, formazione, SCM, 3D">
    <meta name="author" content="Campus Virtual Training Team">
    
    <!-- Meta tags Open Graph per condivisione social -->
    <meta property="og:title" content="Campus Virtual Training">
    <meta property="og:description" content="Sistema di training virtuale per Campus SCM">
    <meta property="og:type" content="website">
    
    <!-- Titolo della pagina (mostrato nella tab del browser) -->
    <title>🎯 Campus Virtual Training - Versione Ottimizzata</title>
    
    <!-- ===== FAVICON ===== -->
    <!-- Icona mostrata nella tab del browser -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🎯</text></svg>">
    
    <!-- ===== FOGLI DI STILE CSS ===== -->
    <!-- Caricamento modulare dei CSS per migliori performance e organizzazione -->
    
    <!-- 1. Stili base e reset CSS -->
    <link rel="stylesheet" href="css/base.css?v=3">
    
    <!-- 2. Componenti riutilizzabili (pulsanti, loader, etc.) -->
    <link rel="stylesheet" href="css/components.css?v=4">
    
    <!-- 3. Layout e posizionamento elementi -->
    <link rel="stylesheet" href="css/layout.css?v=2">
    
    <!-- 4. Stili specifici per le diverse pagine -->
    <link rel="stylesheet" href="css/pages.css">
    
    <!-- ===== PRECONNESSIONI ===== -->
    <!-- Ottimizzazione: preconnessione ai CDN per ridurre latenza -->
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    
    <!-- ===== DIPENDENZE ESTERNE ===== -->
    <!-- Three.js viene ora caricato come ES Module nei nostri script -->
    <!-- Rimuoviamo il caricamento deprecato di three.min.js -->
    
    <!-- ===== INIZIALIZZAZIONE ===== -->
    <!-- Loader semplice mostrato durante il caricamento iniziale -->
    <style>
        /* Stili inline per loader iniziale - evita flash di contenuto non stilizzato */
        #init-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #cad4ff;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            color: white;
            font-family: Arial, sans-serif;
        }
        .init-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255,255,255,0.3);
            border-top: 5px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>

<body>
    <!-- ===== LOADER INIZIALE ===== -->
    <!-- Mostrato durante il caricamento dell'applicazione -->
    <div id="init-loader">
        <div style="text-align: center;">
            <div class="init-spinner"></div>
            <h2>🎯 Campus Virtual Training</h2>
            <p>Caricamento in corso...</p>
        </div>
    </div>

    <!-- ===== PAGINA DI LOGIN ===== -->
    <!-- Pagina iniziale per l'autenticazione -->
    <div id="loginPage">
        <div class="login-container">
            <div class="login-header">
                <h1>🎯 Campus Virtual Training</h1>
                <div class="login-subtitle">Sistema di Formazione Virtuale</div>
            </div>
            
            <div class="login-form-section">
                <h2>🔐 Accesso al Sistema</h2>
                <p>Inserisci le tue credenziali per accedere alla piattaforma</p>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Nome Utente:</label>
                    <input type="text" id="username" name="username" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Password:</label>
                    <input type="password" id="password" name="password" required>
                </div>
                
                <button type="submit" class="btn-login">Accedi</button>
            </form>
            
            <div id="loginError" class="login-error hidden">
                ❌ Credenziali non valide. Riprova.
            </div>
            </div>
            
            <div class="login-footer">
                <small>© 2024 Campus SCM - Sistema di Training Virtuale</small>
            </div>
        </div>
    </div>

    <!-- ===== CONTENITORE PRINCIPALE ===== -->
    <!-- Wrapper principale che contiene tutte le pagine dell'applicazione -->
    <div id="container" class="hidden">
        
        <!-- ===== HOME PAGE ===== -->
        <!-- Pagina iniziale con la selezione degli scenari -->
        <div id="homePage">
            
            <!-- Header della home page -->
            <div id="homeHeader">
                <h1>
                    🎯 Campus Virtual Training
                    <!-- Logo placeholder (sarà sostituito se disponibile) -->
                    <img src="newlogo.png" alt="" class="logo" style="display: none;" id="logoImage">
                </h1>
                <p>Gli scenari vengono caricati automaticamente dal server.</p>
                
            </div>
            
            <!-- Griglia degli scenari disponibili -->
            <!-- Viene popolata dinamicamente dal JavaScript -->
            <div id="scenariosList" role="main" aria-label="Lista scenari disponibili">
                
                <!-- Card placeholder mostrata quando non ci sono scenari caricati -->
                <div class="scenario-card placeholder" role="article">
                    <div class="scenario-image">
                        <div class="placeholder-image" aria-hidden="true">⚙️</div>
                    </div>
                    <div class="scenario-info">
                        <h3>⚙️ Caricamento Scenari</h3>
                        <p>Gli scenari si stanno caricando automaticamente dal server. Una volta caricati, appariranno qui.</p>
                        <small style="color: var(--primary-blue); font-weight: 500;">💾 Caricamento automatico in corso...</small>
                    </div>
                </div>
                
                <!-- Card per modalità manuale -->
                <div class="scenario-card manual-mode" role="button" tabindex="0" 
                     data-manual="true">
                    <div class="scenario-image">
                        <div class="placeholder-image" aria-hidden="true">🔧</div>
                    </div>
                    <div class="scenario-info">
                        <h3>Modalità Manuale</h3>
                        <p>Modalità libera per l'utilizzo di Campus Virtual Training senza scenari predefiniti.</p>
                    </div>
                </div>
                
            </div>
        </div>
        
        <!-- ===== SCENARIO PAGE ===== -->
        <!-- Pagina del visualizzatore 3D con controlli -->
        <div id="scenarioPage" class="hidden">
            
            <!-- Canvas 3D dove viene renderizzata la scena -->
            <!-- Questo elemento viene utilizzato da Three.js per il rendering -->
            <canvas 
                id="canvas3d" 
                role="img" 
                aria-label="Vista interattiva del training virtuale"
                tabindex="0"
            ></canvas>
            
            <!-- ===== HEADER CON CONTROLLI ===== -->
            <!-- Barra superiore con navigazione e controlli principali -->
            <header id="header" role="banner">
                
                <!-- Barra di navigazione -->
                <nav id="navBar" role="navigation" aria-label="Navigazione principale">
                    <!-- Pulsante per tornare alla home -->
                    <button 
                        class="btn-blue" 
                        onclick="UI.goHome()" 
                        aria-label="Torna alla pagina principale"
                        title="Torna alla home page"
                    >
                        🏠 Home
                    </button>
                    
                    <!-- Titolo scenario corrente -->
                    <div id="title">
                        🎯 Scenario: <span id="scenarioTitle">Modalità Manuale</span>
                    </div>
                </nav>
                
                <!-- ===== AREA CONTROLLI ===== -->
                <!-- Contiene tutti i pulsanti e controlli dell'applicazione -->
                <div id="controls" role="toolbar" aria-label="Controlli applicazione">
                
                    <!-- Pulsante per mostrare/nascondere controlli avanzati su mobile -->
                    <button 
                        id="toggleControlsBtn" 
                        class="btn-blue mobile-only hidden" 
                        onclick="UI.toggleMobileControls()"
                        aria-label="Mostra/nascondi controlli avanzati"
                        title="Mostra o nascondi i controlli avanzati"
                        style="position: absolute; top: -35px; right: 10px; padding: 5px 10px; font-size: 12px; z-index: 1000;"
                    >
                        ⚙️
                    </button>
                    
                    <!-- Controlli modalità touch per mobile -->
                    <div id="mobileTouchControls" class="mobile-only hidden" style="position: absolute; top: 110px; left: 10px; background: rgba(0,0,0,0.8); padding: 8px; border-radius: 8px; display: flex; gap: 10px; z-index: 1000;">
                        <label class="mobile-mode-option">
                            <input type="radio" name="mobileMode" value="pan" checked>
                            <span class="mobile-mode-label">📱 Sposta</span>
                        </label>
                        <label class="mobile-mode-option">
                            <input type="radio" name="mobileMode" value="rotate">
                            <span class="mobile-mode-label">🔄 Ruota</span>
                        </label>
                        <label class="mobile-mode-option">
                            <input type="radio" name="mobileMode" value="zoom">
                            <span class="mobile-mode-label">🔍 Zoom</span>
                        </label>
                    </div>
                
                    <!-- Controlli avanzati (nascosti su mobile durante scenario) -->
                    <div id="advancedControls">
                    
                    <!-- ===== CONTROLLI SCENARIO ===== -->
                    
                    
                    <!-- ===== CONTROLLI AZIONI ===== -->
                    <!-- Pulsanti per azioni sulla scena -->
                    
                    
                    
                    
                    <!-- ===== CONTROLLI VISIBILITÀ MODELLI ===== -->
                    <!-- Pannello per controllare la visibilità dei singoli modelli -->
                    <div id="modelsVisibilityPanel" class="hidden" style="display: flex; gap: 5px; flex-wrap: wrap;">
                        <!-- I pulsanti vengono generati dinamicamente -->
                    </div>
                    
                    <!-- ===== INDICATORE STATO ===== -->
                    <!-- Mostra lo stato corrente dell'applicazione -->
                    <div 
                        id="status" 
                        role="status" 
                        aria-live="polite"
                        aria-label="Stato applicazione"
                        title="Stato corrente dell'applicazione"
                    >
                        Pronto
                    </div>
                    
                    </div> <!-- Fine advancedControls -->
                </div>
            </header>
        </div>
        
        <!-- ===== PANNELLO ISTRUZIONI ===== -->
        <!-- Guida per l'utente (mostrato solo quando necessario) -->
        <aside id="instructions" class="hidden" role="complementary" aria-labelledby="instructions-title">
            <h3 id="instructions-title">🎮 Controlli Interattivi:</h3>
            <ul role="list">
                <li><strong>Tasto sinistro + trascina:</strong> Sposta la vista (Pan)</li>
                <li><strong>Tasto destro + trascina:</strong> Ruota intorno al modello</li>
                <li><strong>Rotella mouse / Pinch:</strong> Zoom avanti/indietro</li>
            </ul>
            
            <h3>🎨 File Supportati:</h3>
            <ul role="list">
                <li><strong>Modelli:</strong> OBJ, STL, GLTF, GLB</li>
                <li><strong>Materiali:</strong> MTL (per file OBJ)</li>
                <li><strong>Texture:</strong> JPG, PNG, BMP, TGA</li>
                <li><strong>Animazioni:</strong> TXT, CSV</li>
            </ul>
            
            <p style="font-size: 0.85em; color: #666; margin-top: 8px;">
                💡 <strong>Suggerimento:</strong> Per risultati migliori, assicurati che i file abbiano nomi corrispondenti (es: model.obj + model.mtl + texture.jpg)
            </p>
            
            <!-- Pulsante per nascondere le istruzioni -->
            <button 
                onclick="this.parentElement.classList.add('hidden')" 
                style="background: var(--primary-blue); color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; margin-top: 10px;"
                aria-label="Nascondi istruzioni"
            >
                ❌ Nascondi
            </button>
        </aside>
        
        <!-- Pulsante per mostrare istruzioni (fisso nell'angolo) -->
        <button 
            id="showInstructionsBtn"
            onclick="document.getElementById('instructions').classList.remove('hidden')"
            aria-label="Mostra istruzioni"
            title="Mostra guida controlli"
        >
            ❓
        </button>
    </div>

    <!-- ===== ELEMENTI UI OVERLAY ===== -->
    <!-- Elementi mostrati sopra tutto il resto -->
    
    <!-- ===== LOADER ===== -->
    <!-- Indicatore di caricamento per operazioni lunghe -->
    <div id="loader" class="hidden" role="dialog" aria-labelledby="loader-text" aria-modal="true">
        <div class="spinner" aria-hidden="true"></div>
        <p id="loader-text">Caricamento in corso...</p>
    </div>
    
    <!-- ===== PROGRESS BAR MODELLI ===== -->
    <!-- Barra di avanzamento per caricamento modelli scenario -->
    <div id="modelProgressBar" class="hidden" role="dialog" aria-labelledby="progress-text" aria-modal="true">
        <div class="progress-container">
            <h3 id="progress-text">🔄 Caricamento Scenario</h3>
            <div class="progress-details">
                <span id="progress-current-file">Preparazione...</span>
                <span id="progress-percentage">0%</span>
            </div>
            <div class="progress-bar-track">
                <div id="progress-bar-fill" class="progress-bar-fill"></div>
            </div>
            <div class="progress-info">
                <small id="progress-files-count">0 / 0 file</small>
            </div>
        </div>
    </div>
    
    <!-- ===== MESSAGGIO ERRORE ===== -->
    <!-- Popup per mostrare errori all'utente -->
    <div id="error" class="hidden" role="alert" aria-live="assertive">
        <h3 style="margin: 0 0 10px 0;">⚠️ Errore</h3>
        <p id="errorMessage">Si è verificato un errore</p>
        <button 
            onclick="UI.hideError()" 
            aria-label="Chiudi messaggio di errore"
            style="background: rgba(255,255,255,0.2); color: white; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px;"
        >
            ✖️ Chiudi
        </button>
    </div>

    <!-- ===== SCRIPT JAVASCRIPT ===== -->
    <!-- Caricamento modulare dei JavaScript per organizzazione e performance -->
    <!-- Ora usiamo ES Modules per Three.js moderno -->
    
    <!-- Import map per Three.js ES Modules -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.155.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.155.0/examples/jsm/"
        }
    }
    </script>
    
    <!-- Script per gestione login -->
    <script>
        // Gestione del login
        document.addEventListener('DOMContentLoaded', function() {
            const loginForm = document.getElementById('loginForm');
            const loginError = document.getElementById('loginError');
            
            loginForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                try {
                    // Fetch del file users.txt
                    const response = await fetch('users.txt');
                    const text = await response.text();
                    
                    // Parse delle righe del file
                    const lines = text.split('\n').filter(line => line.trim() !== '');
                    let authenticated = false;
                    
                    // Verifica credenziali
                    for (const line of lines) {
                        const [fileUsername, filePassword] = line.trim().split(';');
                        if (username === fileUsername && password === filePassword) {
                            authenticated = true;
                            break;
                        }
                    }
                    
                    if (authenticated) {
                        // Login riuscito - nascondi login e mostra applicazione
                        document.getElementById('loginPage').classList.add('hidden');
                        document.getElementById('container').classList.remove('hidden');
                        document.getElementById('init-loader').classList.add('hidden');
                    } else {
                        // Login fallito - mostra errore
                        loginError.classList.remove('hidden');
                        document.getElementById('password').value = '';
                    }
                    
                } catch (error) {
                    console.error('Errore durante il login:', error);
                    loginError.textContent = '❌ Errore di connessione. Riprova.';
                    loginError.classList.remove('hidden');
                }
            });
        });
    </script>
    
    <!-- Caricamento moduli in ordine di dipendenza -->
    <script type="module" src="js/app.js?nocache=999999"></script>
    
    <!-- ===== SCRIPT ANALYTICS (opzionale) ===== -->
    <!-- Rimuovi o modifica secondo necessità -->
    <!--
    <script>
        // Esempio Google Analytics 4
        // Sostituisci 'GA_MEASUREMENT_ID' con il tuo ID
        gtag('config', 'GA_MEASUREMENT_ID');
    </script>
    -->
    
    <!-- ===== SERVICE WORKER (opzionale) ===== -->
    <!-- Per funzionalità offline - decommentare se necessario -->
    <!--
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registrato:', registration.scope);
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registrazione fallita:', err);
                    });
            });
        }
    </script>
    -->
    
</body>
</html>

<!-- 
    ============================================================================
    FINE FILE HTML OTTIMIZZATO
    ============================================================================
    
    📋 CARATTERISTICHE IMPLEMENTATE:
    
    ✅ Struttura HTML semantica con ruoli ARIA
    ✅ CSS modulare e organizzato
    ✅ JavaScript modulare con gestione errori
    ✅ Responsive design per tutti i dispositivi
    ✅ Accessibilità completa (WCAG 2.1)
    ✅ Performance ottimizzate (lazy loading, async)
    ✅ SEO e meta tags appropriati
    ✅ Gestione errori robusta
    ✅ Documentazione completa inline
    
    🔧 PER PERSONALIZZARE:
    
    1. Modifica i colori in css/base.css (variabili CSS)
    2. Aggiungi nuovi componenti in css/components.css
    3. Estendi funzionalità in js/config.js
    4. Personalizza messaggi in js/ui.js
    
    📱 COMPATIBILITÀ:
    
    - Chrome 80+, Firefox 75+, Safari 13+, Edge 80+
    - Dispositivi mobili iOS 13+, Android 8+
    - Supporto WebGL 1.0 richiesto
    
    ============================================================================
-->